<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- user-scalable=no removed: violates WCAG 1.4.4; game provides its own font-size control -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="description" content="Phonics matching game for grades 1â€“5. Match words by sound patterns to unlock Lena's magical library!">
    <title>Word Explorer â€” Phonics Matching Game</title>
    <!-- Single font import here; @import removed from CSS to avoid render-blocking double load -->
    <link rel="stylesheet" href="https://fonts.cdnfonts.com/css/opendyslexic" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <!-- Home button -->
    <a href="../" id="home-btn" aria-label="Home">ğŸ  Home</a>

    <!-- Settings button -->
    <button id="settings-btn" aria-label="Open settings" aria-haspopup="dialog" aria-expanded="false">âš™ï¸</button>

    <!-- Settings overlay (click to close) â€” no role, it's a presentational backdrop -->
    <div id="settings-overlay"></div>

    <!-- Settings panel: <div> used (not <aside>) to avoid conflict with explicit role="dialog" -->
    <div id="settings-panel" role="dialog" aria-label="Settings" aria-modal="true" aria-hidden="true">
        <!-- Close button is first focusable element so focus lands here when panel opens -->
        <button id="settings-close" aria-label="Close settings">âœ•</button>
        <h2>Settings</h2>

        <div class="settings-row">
            <label for="mute-speech">Mute word pronunciation</label>
            <input type="checkbox" id="mute-speech">
        </div>

        <div class="settings-row">
            <label for="mute-sfx">Mute sound effects</label>
            <input type="checkbox" id="mute-sfx">
        </div>

        <div class="settings-row">
            <label for="hint-toggle">Show hint tile</label>
            <input type="checkbox" id="hint-toggle" checked>
        </div>
        <p class="settings-note">After tapping a tile, highlights one matching word</p>

        <div class="settings-row">
            <!-- disabled + aria-disabled so AT users can still land on it and hear why it's unavailable -->
            <label for="challenge-toggle">Challenge Mode</label>
            <input type="checkbox" id="challenge-toggle" disabled aria-disabled="true">
        </div>
        <p class="settings-note">Challenge Mode (complete a lesson first to unlock)</p>

        <div class="settings-row">
            <label for="font-size-select">Text size</label>
            <select id="font-size-select">
                <option value="small">Small</option>
                <option value="medium" selected>Medium</option>
                <option value="large">Large</option>
            </select>
        </div>

        <button id="unlock-btn">ğŸ”“ Unlock all lessons</button>
        <p class="settings-note">Requires PIN (for parents &amp; teachers)</p>
    </div>

    <!-- ================================================================
         Screen: Lesson Select
         ================================================================ -->
    <main id="screen-select" class="screen active">
        <header class="select-header">
            <div id="lena-corner" class="lena-corner">
                <img src="assets/lena.svg" alt="Lena the Word Explorer" class="lena-img">
                <div class="lena-info">
                    <div class="lena-name">Lena's Library</div>
                    <div id="lena-progress-text">0/30 rooms explored</div>
                    <div id="lena-progress-bar" class="lena-progress-bar"
                         role="progressbar" aria-valuemin="0" aria-valuemax="30"
                         aria-valuenow="0" aria-label="Rooms explored">
                        <div id="lena-progress-bar-fill" class="lena-progress-bar-fill"></div>
                    </div>
                </div>
            </div>
            <h1>Word Explorer</h1>
        </header>
        <p class="select-subtitle">Tap a lesson to begin!</p>

        <!-- Grade filter tabs -->
        <nav class="grade-filter" aria-label="Filter by grade">
            <button class="grade-tab active" data-grade="all">ALL</button>
            <button class="grade-tab" data-grade="1">Grade 1</button>
            <button class="grade-tab" data-grade="2">Grade 2</button>
            <button class="grade-tab" data-grade="3">Grade 3</button>
            <button class="grade-tab" data-grade="4">Grade 4</button>
            <button class="grade-tab" data-grade="5">Grade 5</button>
        </nav>

        <!-- Lesson grid â€” populated by game.js (role="group" since children are role="button") -->
        <div id="lesson-grid" role="group" aria-label="Lessons"></div>
    </main>

    <!-- ================================================================
         Screen: Game Board
         ================================================================ -->
    <div id="screen-board" class="screen" role="region" aria-label="Game board">
        <div id="board-header">
            <button id="board-back-btn" aria-label="Back to lesson select">â† Back</button>
            <h2 id="board-lesson-title">Lesson Title</h2>
            <div id="board-progress" aria-live="polite">0 / 0 matched</div>
            <div id="board-mode-indicator" class="mode-indicator">
                <span id="board-mode-label">Explorer Mode ğŸ—ºï¸</span>
                <div id="energy-bar-container" class="energy-bar-container">
                    <div id="energy-bar-fill" class="energy-bar-fill"></div>
                    <span class="energy-icon" aria-hidden="true">âš¡</span>
                </div>
            </div>
        </div>
        <div id="board-grid" class="board-grid" role="group" aria-label="Word tiles"></div>
        <div id="board-hint" class="board-hint">
            Tap a word, then find more words with the same sound!
        </div>
        <div id="board-pattern-feedback" class="pattern-feedback" aria-live="polite"></div>
    </div>

    <!-- ================================================================
         Screen: Sort Mode
         ================================================================ -->
    <div id="screen-sort" class="screen" role="region" aria-label="Sort mode">
        <div id="sort-header">
            <button id="sort-back-btn" aria-label="Back to lesson select">â† Back</button>
            <h2 id="sort-lesson-title">Sort Mode</h2>
            <div id="sort-progress" aria-live="polite">Word 0 of 0</div>
        </div>

        <div id="sort-word-section">
            <p class="sort-instruction">Which bucket does this word belong in?</p>
            <div id="sort-word-container">
                <!-- aria-live announces each new word to screen readers automatically -->
                <div id="sort-word-card" class="sort-word-card" aria-live="polite"></div>
                <button id="sort-speaker-btn" class="sort-speaker-btn" aria-label="Hear word">ğŸ”Š Hear it</button>
            </div>
            <div id="sort-feedback" class="sort-feedback" aria-live="polite"></div>
            <div id="sort-buckets" class="sort-buckets" role="group" aria-label="Pattern buckets"></div>
        </div>

        <div id="sort-complete-section" class="hidden">
            <div class="sort-complete-card">
                <p id="sort-complete-msg" class="sort-complete-msg"></p>
                <div class="sort-complete-buttons">
                    <button id="sort-again-btn" class="sort-btn">ğŸ”„ Sort Again</button>
                    <button id="sort-play-board-btn" class="sort-btn sort-btn-primary">ğŸ® Play the Board</button>
                    <button id="sort-all-lessons-btn" class="sort-btn">ğŸ“š All Lessons</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ================================================================
         Screen: Post-Lesson Summary
         ================================================================ -->
    <div id="screen-summary" class="screen" role="region" aria-label="Lesson summary">
        <div class="summary-card">
            <h2 id="summary-title">Lesson Complete!</h2>
            <p id="summary-challenge-msg" class="summary-stat hidden"></p>
            <div id="summary-stars" class="summary-stars" aria-label="Stars earned"></div>
            <div id="summary-accuracy" class="summary-stat"></div>
            <div id="summary-streak" class="summary-stat"></div>

            <div class="summary-words-section">
                <h3>Words You Matched âœ“</h3>
                <div id="summary-matched-words" class="summary-word-list"></div>
            </div>

            <div class="summary-words-section" id="summary-review-section">
                <h3>Words to Practice ğŸ”</h3>
                <div id="summary-wrong-words" class="summary-word-list"></div>
            </div>

            <div class="summary-buttons">
                <button class="summary-btn" id="summary-play-again">ğŸ”„ Play Again</button>
                <button class="summary-btn summary-btn-primary" id="summary-next-lesson">Next Lesson â†’</button>
                <button class="summary-btn" id="summary-all-lessons">ğŸ“š All Lessons</button>
            </div>
        </div>
    </div>

    <!-- Mode Select overlay â€” shown after tutorial (or directly) before each lesson play -->
    <div id="mode-select-overlay" class="mode-select-overlay" role="dialog"
         aria-modal="true" aria-labelledby="mode-select-title" aria-hidden="true">
        <div class="mode-select-card">
            <!-- Close button is first focusable element; defaults to Explorer Mode (CLAUDE.md modal rule) -->
            <button id="mode-select-close" class="mode-select-close-btn" aria-label="Close, use Explorer Mode">âœ•</button>
            <h2 id="mode-select-title" class="mode-select-title">How do you want to play?</h2>
            <button id="mode-explorer-btn" class="mode-btn mode-explorer">
                <div class="mode-icon" aria-hidden="true">ğŸ—ºï¸</div>
                <div class="mode-name">Explorer Mode</div>
                <div class="mode-desc">No time pressure. Take your time!</div>
            </button>
            <button id="mode-challenge-btn" class="mode-btn mode-challenge">
                <div class="mode-icon" aria-hidden="true">âš¡</div>
                <div class="mode-name">Challenge Mode</div>
                <div class="mode-desc">Match as many as you can before energy runs out!</div>
            </button>
        </div>
    </div>

    <!-- Tutorial overlay â€” 3-step first-play walkthrough for each new phonics pattern -->
    <div id="tutorial-overlay" class="tutorial-overlay" role="dialog" aria-modal="true"
         aria-labelledby="tut-title" aria-hidden="true">
        <div class="tutorial-card">
            <div id="tut-step" class="tut-step">Step 1 of 3</div>
            <h2 id="tut-title" class="tut-title"></h2>
            <div id="tut-body" class="tut-body"></div>
            <div class="tut-buttons">
                <button id="tut-skip-btn" class="tut-btn tut-btn-secondary">Skip Tutorial</button>
                <button id="tut-next-btn" class="tut-btn tut-btn-primary">Next â†’</button>
            </div>
        </div>
    </div>

    <!-- Celebration overlay (after lesson complete â€” auto-dismissing, tappable) -->
    <div id="celebration-overlay" class="celebration-overlay"
         role="dialog" aria-modal="true" aria-label="Lesson complete celebration" aria-hidden="true">
        <div class="celebration-card">
            <img src="assets/lena.svg" alt="" class="celebration-lena" aria-hidden="true">
            <h2 id="celebration-title" class="celebration-title"></h2>
            <p id="celebration-subtitle" class="celebration-subtitle"></p>
            <div id="celebration-confetti" class="confetti-container"></div>
            <button id="celebration-dismiss-btn" class="celebration-dismiss-btn">Continue â†’</button>
        </div>
    </div>

    <!-- Narrative overlay (room unlock â€” auto-dismissing visual; text announced via #aria-live) -->
    <div id="narrative-overlay" class="narrative-overlay" aria-hidden="true">
        <img src="assets/lena.svg" alt="" class="narrative-lena" aria-hidden="true">
        <p id="narrative-msg" class="narrative-msg"></p>
        <p class="narrative-tap-hint">Tap to continue</p>
    </div>

    <!-- PIN dialog â€” unlock all lessons (parent/teacher gated) -->
    <div id="pin-overlay"></div>
    <div id="pin-dialog" role="dialog" aria-modal="true" aria-label="Enter PIN to unlock lessons" aria-hidden="true">
        <button id="pin-close" aria-label="Cancel">âœ•</button>
        <h3>Enter PIN</h3>
        <p>Enter the parent or teacher PIN to unlock all lessons.</p>
        <input type="password" id="pin-input" aria-label="PIN" maxlength="10" autocomplete="off">
        <p id="pin-error" aria-live="polite"></p>
        <button id="pin-submit">Unlock</button>
    </div>

    <!-- Loading overlay â€” shown while lesson JSON fetches; hidden via .open class (no style.display) -->
    <div id="loading-overlay" class="loading-overlay" role="status">Loading...<span aria-hidden="true"> ğŸ“š</span></div>

    <!-- Live region for accessibility announcements -->
    <div id="aria-live" aria-live="polite" aria-atomic="true" style="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;"></div>

    <!-- Scripts â€” load order matters (dependencies declared first) -->
    <script src="js/save.js" defer></script>
    <script src="js/data.js" defer></script>
    <script src="js/speech.js" defer></script>
    <script src="js/audio.js" defer></script>
    <script src="js/board.js" defer></script>
    <script src="js/match.js" defer></script>
    <script src="js/score.js" defer></script>
    <script src="js/tutorial.js" defer></script>
    <script src="js/feedback.js" defer></script>
    <script src="js/sort.js" defer></script>
    <script src="js/narrative.js" defer></script>
    <script src="js/game.js" defer></script>
</body>
</html>
